import{e,L as a,v as s,j as l,g as t,i as n,u as r,z as c,A as u,B as o,k as i,t as p,m as d,w as v,F as m,r as x,o as h,f as g,C as w,H as b}from"./vue-vendor.js";import{c as f,a as y,u as k}from"./index.js";import{u as _,D as V}from"./Dialog.js";import{C as j,c as C,a as U,d as M}from"./system.js";import{S as L,b as z}from"./validation.js";import{S}from"./settings2.js";import{P as A}from"./power.js";import{L as D}from"./lock.js";
/**
 * @license lucide-vue-next v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const T=f("bell",[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]]),q=f("download",[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]]),P=f("external-link",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]),H=f("key",[["path",{d:"m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4",key:"g0fldk"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}]]),I=f("send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]),O=f("shield-check",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);
/**
 * @license lucide-vue-next v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B={class:"space-y-4"},F={class:"flex items-center gap-3 px-1"},N={class:"w-9 h-9 rounded-xl bg-gradient-to-br from-slate-500/20 to-slate-600/10 flex items-center justify-center"},E={class:"card"},G={class:"space-y-6"},J={class:"form-group"},K={class:"form-group"},Q={class:"form-group"},R={class:"form-group"},W={key:0,class:"pt-4 border-t border-dark-300"},X={class:"flex items-center gap-3 mb-4"},Y={class:"w-6 h-6 rounded-md bg-accent-500/20 flex items-center justify-center"},Z={class:"flex-1"},$={class:"space-y-4"},ee={class:"form-group"},ae={class:"form-group"},se={class:"pt-4 border-t border-dark-300"},le={class:"card"},te={class:"grid grid-cols-2 gap-3"},ne={class:"space-y-4"},re={class:"form-group"},ce={class:"form-label"},ue={class:"form-group"},oe={class:"form-label"},ie={class:"form-group"},pe={class:"form-label"},de={class:"h-[160px] flex flex-col items-center justify-center text-center"},ve={class:"text-xs text-slate-500 mt-1"},me={class:"text-slate-400"},xe={class:"text-accent-400"},he={class:"w-full h-[42px]"},ge=e({__name:"Settings",setup(e){const f=w(),ge=y(),we=k(),be=x(!1),fe=x(""),ye=x(""),ke=x(""),_e=x(!1),Ve=x("idle"),je=x({currentVersion:"",latestVersion:"",message:""}),Ce=a({wxpusher_enabled:0,wx_app_token:"",wx_my_uid:"",wxpusher_api_url:"https://wxpusher.zjiecode.com/api/send/message",ping_target:"223.5.5.5",auto_switch_max_retries:25,retry_wifi_interval:688,restart_threshold:10,show_wxpusher:0}),Ue=a({...Ce});async function Me(){try{const e=await async function(e){return _.call("wx-wireless","save_settings",e)}(Ce);"success"===e.status?(Object.assign(Ue,Ce),ge.success("配置已保存")):ge.error(e.message||"保存失败")}catch(e){ge.error("保存配置失败")}}function Le(){window.open("https://wxpusher.zjiecode.com/admin/login","_blank")}async function ze(){ge.showLoading("正在发送测试消息");try{const e=await async function(){return _.call("wx-wireless","test_push",{})}();ge.hideLoading(),"success"===e.status?ge.success(e.message||"测试消息已发送"):ge.error(e.message||"发送失败")}catch(e){ge.hideLoading(),ge.error("发送测试消息失败")}}async function Se(){if(ye.value===ke.value)if(z(ye.value,6,63)){be.value=!1,ge.showLoading("正在应用密码修改");try{const e=await C(fe.value,ye.value);"success"===e.status?(ge.success("密码修改成功，请重新登录"),await new Promise(e=>setTimeout(e,1500)),fe.value="",ye.value="",ke.value="",await we.logout(),f.push("/login")):ge.error(e.message||"修改失败")}catch(e){ge.error("密码修改请求失败")}finally{ge.hideLoading()}}else ge.error("密码只能包含英文、数字和符号，长度6-63位");else ge.error("两次输入的密码不一致")}function Ae(){_e.value=!0,Ve.value="idle",je.value={currentVersion:"",latestVersion:"",message:""}}function De(){"updating"!==Ve.value&&(_e.value=!1)}async function Te(){Ve.value="checking";try{const e=await U();"latest"===e.status?(Ve.value="latest",je.value={currentVersion:e.current_version,latestVersion:e.latest_version,message:e.message}):"available"===e.status?(Ve.value="available",je.value={currentVersion:e.current_version,latestVersion:e.latest_version,message:e.message}):(Ve.value="error",je.value.message=e.message||"检查更新失败")}catch(e){Ve.value="error",je.value.message="网络连接失败"}}async function qe(){Ve.value="updating";try{const e=await M();"success"===e.status?(Ve.value="success",je.value={currentVersion:e.current_version,latestVersion:e.latest_version,message:e.message},setTimeout(()=>window.location.reload(),3e3)):(Ve.value="error",je.value.message=e.message||"更新失败")}catch(e){Ve.value="error",je.value.message="更新过程中出错"}}return s(async()=>{await async function(){try{const e=await async function(){return _.call("wx-wireless","get_settings",{})}();"success"===e.status?(Object.assign(Ce,e),Object.assign(Ue,e)):ge.error(e.message||"加载配置失败")}catch(e){ge.error("加载配置失败")}}()}),(e,a)=>{const s=b("AlertTriangle");return h(),l(m,null,[t("div",B,[t("div",F,[t("div",N,[n(r(S),{class:"w-4 h-4 text-slate-400"})]),a[12]||(a[12]=t("div",null,[t("h2",{class:"text-lg font-bold text-white"},"系统配置"),t("p",{class:"text-[10px] text-slate-500 font-normal"},"System Settings")],-1))]),t("div",E,[t("div",G,[t("div",J,[a[13]||(a[13]=t("label",{class:"form-label"},[t("span",null,"Ping 目标 IP")],-1)),c(t("input",{"onUpdate:modelValue":a[0]||(a[0]=e=>Ce.ping_target=e),type:"text",class:"input font-mono",placeholder:"223.5.5.5 119.29.29.29",autocomplete:"new-password"},null,512),[[u,Ce.ping_target]]),a[14]||(a[14]=t("p",{class:"text-[10px] text-slate-500 mt-1"},"建议使用公共DNS。如阿里、腾讯，多个用空格分隔",-1))]),t("div",K,[a[15]||(a[15]=t("label",{class:"form-label"},[t("span",null,"最大重试次数")],-1)),c(t("input",{"onUpdate:modelValue":a[1]||(a[1]=e=>Ce.auto_switch_max_retries=e),type:"number",class:"input",min:"1",autocomplete:"new-password"},null,512),[[u,Ce.auto_switch_max_retries,void 0,{number:!0}]])]),t("div",Q,[a[16]||(a[16]=t("label",{class:"form-label"},[t("span",null,"重试冷却时间 (秒)")],-1)),c(t("input",{"onUpdate:modelValue":a[2]||(a[2]=e=>Ce.retry_wifi_interval=e),type:"number",class:"input",min:"60",autocomplete:"new-password"},null,512),[[u,Ce.retry_wifi_interval,void 0,{number:!0}]])]),t("div",R,[a[17]||(a[17]=t("label",{class:"form-label"},[t("span",null,"重启阈值 (次)")],-1)),c(t("input",{"onUpdate:modelValue":a[3]||(a[3]=e=>Ce.restart_threshold=e),type:"number",class:"input",min:"1",autocomplete:"new-password"},null,512),[[u,Ce.restart_threshold,void 0,{number:!0}]])]),1===Ce.show_wxpusher?(h(),l("div",W,[t("div",X,[t("div",Y,[n(r(T),{class:"w-3 h-3 text-accent-400"})]),t("div",Z,[a[20]||(a[20]=t("span",{class:"text-sm font-medium text-white"},"消息推送",-1)),t("button",{class:"inline-flex items-center gap-0.5 text-primary-400 hover:text-primary-300 ml-2 text-[10px]",onClick:Le},[a[18]||(a[18]=o(" 获取配置 ",-1)),n(r(P),{class:"w-2.5 h-2.5"})]),t("button",{class:"inline-flex items-center gap-0.5 text-accent-400 hover:text-accent-300 ml-2 text-[10px]",onClick:ze},[a[19]||(a[19]=o(" 测试推送 ",-1)),n(r(I),{class:"w-2.5 h-2.5"})])]),t("div",{class:i(["flex items-center gap-1.5 px-2 py-1 rounded-full text-xs font-medium transition-colors cursor-pointer select-none",1===Ce.wxpusher_enabled?"bg-success-500/20 text-success-400":"bg-slate-700/50 text-slate-500"]),onClick:a[4]||(a[4]=e=>Ce.wxpusher_enabled=1===Ce.wxpusher_enabled?0:1)},[n(r(A),{class:"w-3 h-3"}),t("span",null,p(1===Ce.wxpusher_enabled?"已开启":"已关闭"),1)],2)]),t("div",$,[t("div",ee,[a[21]||(a[21]=t("label",{class:"form-label"},[t("span",null,"应用 Token")],-1)),c(t("input",{"onUpdate:modelValue":a[5]||(a[5]=e=>Ce.wx_app_token=e),type:"text",class:"input font-mono text-sm",placeholder:"AT_xxxxxxxx",autocomplete:"new-password"},null,512),[[u,Ce.wx_app_token]])]),t("div",ae,[a[22]||(a[22]=t("label",{class:"form-label"},[t("span",null,"用户 UID")],-1)),c(t("input",{"onUpdate:modelValue":a[6]||(a[6]=e=>Ce.wx_my_uid=e),type:"text",class:"input font-mono text-sm",placeholder:"UID_xxxxxxxx",autocomplete:"new-password"},null,512),[[u,Ce.wx_my_uid]])])])])):d("",!0),t("div",se,[t("button",{class:"btn btn-primary w-full",onClick:Me},[n(r(L),{class:"w-4 h-4"}),a[23]||(a[23]=t("span",null,"保存配置",-1))])])])]),t("div",le,[t("div",te,[t("button",{class:"btn btn-ghost",onClick:a[7]||(a[7]=e=>be.value=!0)},[n(r(H),{class:"w-4 h-4"}),a[24]||(a[24]=t("span",null,"修改密码",-1))]),t("button",{class:"btn btn-ghost",onClick:Ae},[n(r(q),{class:"w-4 h-4"}),a[25]||(a[25]=t("span",null,"系统更新",-1))])])])]),n(V,{visible:be.value,title:"修改密码",icon:r(H),onClose:a[11]||(a[11]=e=>be.value=!1)},{footer:v(()=>[t("button",{class:"btn btn-primary flex-1",onClick:Se},[n(r(O),{class:"w-4 h-4"}),a[29]||(a[29]=o(" 确定修改 ",-1))])]),default:v(()=>[t("div",ne,[t("div",re,[t("label",ce,[n(r(D),{class:"w-4 h-4"}),a[26]||(a[26]=t("span",null,"当前密码",-1))]),c(t("input",{"onUpdate:modelValue":a[8]||(a[8]=e=>fe.value=e),type:"password",class:"input",placeholder:"请输入当前密码",autocomplete:"off"},null,512),[[u,fe.value]])]),t("div",ue,[t("label",oe,[n(r(H),{class:"w-4 h-4"}),a[27]||(a[27]=t("span",null,"新密码",-1))]),c(t("input",{"onUpdate:modelValue":a[9]||(a[9]=e=>ye.value=e),type:"password",class:"input",placeholder:"请输入新密码（至少6位）",autocomplete:"new-password"},null,512),[[u,ye.value]])]),t("div",ie,[t("label",pe,[n(r(O),{class:"w-4 h-4"}),a[28]||(a[28]=t("span",null,"确认新密码",-1))]),c(t("input",{"onUpdate:modelValue":a[10]||(a[10]=e=>ke.value=e),type:"password",class:"input",placeholder:"请再次输入新密码",autocomplete:"new-password"},null,512),[[u,ke.value]])])])]),_:1},8,["visible","icon"]),n(V,{visible:_e.value,title:"系统更新",icon:r(q),onClose:De},{footer:v(()=>[t("div",he,["idle"===Ve.value?(h(),l("button",{key:0,class:"btn btn-primary w-full h-full",onClick:Te},"检查更新")):"available"===Ve.value?(h(),l("button",{key:1,class:"btn btn-primary w-full h-full",onClick:qe},"立即更新")):"error"===Ve.value?(h(),l("button",{key:2,class:"btn btn-primary w-full h-full",onClick:Te},"重试")):d("",!0)])]),default:v(()=>[t("div",de,[t("div",{class:i(["w-14 h-14 rounded-full flex items-center justify-center mb-3",{"bg-primary-500/10":"idle"===Ve.value,"bg-slate-700/50":"checking"===Ve.value,"bg-success-500/10":"latest"===Ve.value||"success"===Ve.value,"bg-accent-500/10":"available"===Ve.value||"updating"===Ve.value,"bg-danger-500/10":"error"===Ve.value}])},["checking"===Ve.value||"updating"===Ve.value?(h(),l("div",{key:0,class:i(["w-6 h-6 border-2 border-t-transparent rounded-full animate-spin","checking"===Ve.value?"border-primary-400":"border-accent-400"])},null,2)):"idle"===Ve.value||"available"===Ve.value?(h(),g(r(q),{key:1,class:i(["w-6 h-6","idle"===Ve.value?"text-primary-400":"text-accent-400"])},null,8,["class"])):"latest"===Ve.value||"success"===Ve.value?(h(),g(r(j),{key:2,class:"w-6 h-6 text-success-400"})):"error"===Ve.value?(h(),g(s,{key:3,class:"w-6 h-6 text-danger-400"})):d("",!0)],2),t("p",{class:i(["font-medium text-base",{"text-slate-300":"idle"===Ve.value||"checking"===Ve.value||"updating"===Ve.value,"text-success-400":"latest"===Ve.value||"success"===Ve.value,"text-accent-400":"available"===Ve.value,"text-danger-400":"error"===Ve.value}])},p("idle"===Ve.value?"检查系统更新":"checking"===Ve.value?"正在检查...":"latest"===Ve.value?"已是最新版本":"available"===Ve.value?"发现新版本":"updating"===Ve.value?"正在更新...":"success"===Ve.value?"更新成功":"更新失败"),3),t("p",ve,["idle"===Ve.value?(h(),l(m,{key:0},[o("点击下方按钮检查更新")],64)):"checking"===Ve.value?(h(),l(m,{key:1},[o("正在连接服务器")],64)):"latest"===Ve.value?(h(),l(m,{key:2},[o(p(je.value.currentVersion),1)],64)):"available"===Ve.value?(h(),l(m,{key:3},[t("span",me,p(je.value.currentVersion),1),a[30]||(a[30]=t("span",{class:"mx-1"},"→",-1)),t("span",xe,p(je.value.latestVersion),1)],64)):"updating"===Ve.value?(h(),l(m,{key:4},[o("更新期间请勿断开电源")],64)):"success"===Ve.value?(h(),l(m,{key:5},[o("即将自动刷新")],64)):"error"===Ve.value?(h(),l(m,{key:6},[o(p(je.value.message),1)],64)):d("",!0)])])]),_:1},8,["visible","icon"])],64)}}});export{ge as default};
