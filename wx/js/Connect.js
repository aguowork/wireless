import{e,v as s,I as a,j as l,g as t,i as n,u as i,y as r,B as o,z as c,A as u,K as d,f as p,l as m,m as v,w as y,F as f,r as b,c as x,o as h,G as w,t as g,k,C as j,J as C}from"./vue-vendor.js";import{u as W}from"./wireless2.js";import{c as S,a as F,T as G,L as N}from"./index.js";import{D as _}from"./Dialog.js";import{S as M}from"./Select.js";import{a as P,s as A,g as V}from"./wireless3.js";import{S as T,i as L,a as I}from"./validation.js";import{W as U}from"./wifi.js";import{L as z}from"./lock.js";import{E as K,a as q}from"./eye.js";import{R as E}from"./radio.js";import{L as B}from"./lock-open.js";
/**
 * @license lucide-vue-next v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const D=S("chevron-right",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]),J=S("link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]),O=S("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]]),R=S("shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]),$=S("wifi-off",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}],["path",{d:"M5 12.859a10 10 0 0 1 5.17-2.69",key:"1dl1wf"}],["path",{d:"M19 12.859a10 10 0 0 0-2.007-1.523",key:"4k23kn"}],["path",{d:"M2 8.82a15 15 0 0 1 4.177-2.643",key:"1grhjp"}],["path",{d:"M22 8.82a15 15 0 0 0-11.288-3.764",key:"z3jwby"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]),H={class:"space-y-4"},Q={class:"flex items-center gap-3 px-1"},X={class:"w-9 h-9 rounded-xl bg-gradient-to-br from-primary-500/20 to-primary-600/10 flex items-center justify-center"},Y={class:"flex items-center gap-3"},Z={class:"w-10 h-10 rounded-lg bg-primary-500/20 flex items-center justify-center"},ee={class:"form-group"},se={class:"flex items-center justify-between"},ae={class:"form-label"},le=["disabled"],te={class:"form-group"},ne={class:"form-label"},ie={key:0,class:"form-group"},re={class:"form-label"},oe={class:"relative group/input"},ce=["type"],ue={class:"form-group"},de={class:"form-label"},pe={class:"flex gap-3 pt-2"},me={class:"max-h-72 overflow-y-auto -mx-2 scrollbar-smart"},ve={key:0,class:"text-center py-12"},ye={class:"inline-flex items-center justify-center w-16 h-16 rounded-full bg-slate-700/50 mb-4"},fe=["onClick"],be={class:"flex items-center gap-3"},xe={class:"w-10 h-10 rounded-lg bg-primary-500/20 flex items-center justify-center"},he={class:"text-white font-medium"},we={class:"flex gap-2"},ge={class:"badge"},ke={class:"space-y-4"},je={class:"flex items-start gap-3 p-4 rounded-xl bg-warning-500/10 border border-warning-500/20"},Ce={class:"h-[280px] overflow-y-auto -mx-2 scrollbar-smart"},We={key:0,class:"flex flex-col items-center justify-center h-full"},Se={class:"inline-flex items-center justify-center w-16 h-16 rounded-full bg-primary-500/10 mb-4"},Fe={key:1,class:"flex flex-col items-center justify-center h-full"},Ge={class:"inline-flex items-center justify-center w-16 h-16 rounded-full bg-primary-500/10 mb-4"},Ne={key:2,class:"flex flex-col items-center justify-center h-full"},_e={class:"inline-flex items-center justify-center w-16 h-16 rounded-full bg-slate-700/50 mb-4"},Me=["onClick"],Pe={class:"flex items-center gap-3 min-w-0 flex-1"},Ae={class:"w-10 h-10 rounded-lg bg-slate-800/50 flex items-center justify-center flex-shrink-0"},Ve={class:"w-6 h-6",viewBox:"0 0 24 24",fill:"none"},Te={class:"min-w-0 flex-1"},Le={class:"text-white font-medium truncate"},Ie={class:"text-xs text-slate-500"},Ue={class:"w-full -mt-4"},ze={class:"text-xs text-slate-500 text-center h-5 mb-1"},Ke={key:0},qe=["disabled"],Ee=e({__name:"Connect",setup(e){let S=null,Ee=null,Be="";const De=b(!1),Je=j(),Oe=W(),Re=F(),$e=b(!1),He=b(!1),Qe=b(!1),Xe=b(!1),Ye=b(""),Ze=b({ssid:"",encryption:"psk2",key:"",band:""}),es=[{value:"psk2",label:"WPA2-PSK (强安全性)"},{value:"sae",label:"WPA3-SAE (强安全性)"},{value:"psk",label:"WPA-PSK (弱安全性)"},{value:"owe",label:"OWE (开放网络)"},{value:"none",label:"无加密 (开放网络)"}],ss=x(()=>"none"!==Ze.value.encryption&&"owe"!==Ze.value.encryption);function as(e){if(!e.enabled)return"无加密";const s=e.wpa||[];return s.includes(1)&&s.includes(2)?"WPA/WPA2":s.includes(2)?"WPA2":s.includes(1)?"WPA":"加密"}function ls(e){return e>=-50?"极强":e>=-60?"强":e>=-70?"中":e>=-80?"弱":"极弱"}function ts(e){return e>=-50?{level:3,hex:"#4ade80"}:e>=-65?{level:2,hex:"#4ade80"}:e>=-75?{level:1,hex:"#fbbf24"}:{level:0,hex:"#f87171"}}s(async()=>{Oe.fetchKnownNetworks()});const ns=x(()=>Oe.scannedNetworks.filter(e=>e.ssid).sort((e,s)=>s.signal-e.signal));async function is(){Qe.value=!0;try{const[e,s]=await Promise.all([P("2g"),P("5g")]),a=(e.results||[]).map(e=>({...e,band:"2.4G"})),l=(s.results||[]).map(e=>({...e,band:"5G"})),t=[...a,...l];t.length>0&&(Oe.scannedNetworks=t,Xe.value=!0,Ye.value=s.scan_time||e.scan_time||"")}catch{}}let rs=null,os=null;function cs(){rs&&(clearInterval(rs),rs=null),os&&(clearTimeout(os),os=null)}let us=!1,ds=!1;async function ps(){try{const[e,s]=await Promise.all([P("2g"),P("5g")]),a=(e.results||[]).map(e=>({...e,band:"2.4G"})),l=(s.results||[]).map(e=>({...e,band:"5G"}));return a.length>0&&!us&&(us=!0,Oe.scannedNetworks=[...Oe.scannedNetworks.filter(e=>"2.4G"!==e.band),...a],e.scan_time&&(Ye.value=e.scan_time)),l.length>0&&!ds&&(ds=!0,Oe.scannedNetworks=[...Oe.scannedNetworks.filter(e=>"5G"!==e.band),...l],s.scan_time&&s.scan_time>(Ye.value||"")&&(Ye.value=s.scan_time)),!(!us||!ds)}catch{}return!1}async function ms(){Oe.isScanning||(Oe.isScanning=!0,Oe.scannedNetworks=[],Xe.value=!0,cs(),us=!1,ds=!1,Promise.all([A("2g"),A("5g")]).catch(()=>{}),setTimeout(async()=>{if(await ps())return cs(),void(Oe.isScanning=!1);rs=setInterval(async()=>{await ps()&&(cs(),Oe.isScanning=!1)},2e3)},5e3),os=setTimeout(()=>{cs(),Oe.isScanning=!1},2e4))}function vs(){Qe.value=!1}function ys(){bs()&&(He.value=!0)}async function fs(){if(!bs())return;await Oe.saveNetwork({name:Ze.value.ssid,encryption:Ze.value.encryption,password:Ze.value.key,band:Ze.value.band})?(Re.success("配置已保存"),Ze.value={ssid:"",encryption:"psk2",key:"",band:""}):Re.error(Oe.error||"保存失败")}function bs(){return L(Ze.value.ssid)?Ze.value.band?ss.value&&!Ze.value.key?(Re.error("请输入WiFi密码"),!1):!(ss.value&&!I(Ze.value.key))||(Re.error("密码只能包含英文、数字和符号，长度8-63位"),!1):(Re.error("请选择频段"),!1):(Re.error("请输入有效的WiFi名称 (1-32字符)"),!1)}function xs(){Ee&&(clearTimeout(Ee),Ee=null),S&&(clearInterval(S),S=null)}async function hs(){He.value=!1,Be=Ze.value.ssid,await Oe.saveNetwork({name:Ze.value.ssid,encryption:Ze.value.encryption,password:Ze.value.key,band:Ze.value.band}),Oe.connectToWiFi({ssid:Ze.value.ssid,encryption:Ze.value.encryption,key:Ze.value.key,band:Ze.value.band.toLowerCase()}).catch(()=>{}),Re.startCountdown(60,()=>{xs(),Re.hideLoading(),Je.push({name:"status"})}),Ee=setTimeout(()=>{S||(S=setInterval(async()=>{try{const e=await V();e.relay_enabled&&e.ssid===Be&&(xs(),Re.hideLoading(),Re.success(`已连接到 ${Be}`),Je.push({name:"status"}))}catch{}},3e3))},3e4)}return a(()=>{xs(),cs()}),(e,s)=>(h(),l(f,null,[t("div",H,[t("div",Q,[t("div",X,[n(i(J),{class:"w-4 h-4 text-primary-400"})]),s[11]||(s[11]=t("div",null,[t("h2",{class:"text-lg font-bold text-white"},"连接热点"),t("p",{class:"text-[10px] text-slate-500"},"Connect WiFi")],-1))]),t("form",{class:"card space-y-5",onSubmit:s[6]||(s[6]=r(()=>{},["prevent"]))},[t("button",{class:"w-full flex items-center justify-between p-4 rounded-xl bg-primary-500/10 border border-primary-500/20 hover:bg-primary-500/15 transition-colors group",onClick:s[0]||(s[0]=e=>$e.value=!0)},[t("div",Y,[t("div",Z,[n(i(T),{class:"w-5 h-5 text-primary-400"})]),s[12]||(s[12]=t("div",{class:"text-left"},[t("p",{class:"text-white font-medium"},"选择已知热点"),t("p",{class:"text-xs text-slate-500"},"从已保存的网络中选择")],-1))]),n(i(D),{class:"w-5 h-5 text-slate-500 group-hover:text-primary-400 transition-colors"})]),t("div",ee,[t("div",se,[t("label",ae,[n(i(U),{class:"w-4 h-4"}),s[13]||(s[13]=t("span",null,"WiFi 名称",-1))]),t("button",{type:"button",class:"flex items-center gap-1 px-2 py-1 rounded-md bg-primary-500/10 text-primary-400 text-xs font-medium hover:bg-primary-500/20 transition-colors mr-2",disabled:i(Oe).isScanning,onClick:is},[n(i(O),{class:"w-3 h-3"}),s[14]||(s[14]=o(" 扫描 ",-1))],8,le)]),c(t("input",{"onUpdate:modelValue":s[1]||(s[1]=e=>Ze.value.ssid=e),type:"text",class:"input",placeholder:"输入 WiFi 名称",autocomplete:"new-password"},null,512),[[u,Ze.value.ssid]])]),t("div",te,[t("label",ne,[n(i(R),{class:"w-4 h-4"}),s[15]||(s[15]=t("span",null,"安全性",-1))]),n(M,{modelValue:Ze.value.encryption,"onUpdate:modelValue":s[2]||(s[2]=e=>Ze.value.encryption=e),options:es,placeholder:"选择加密方式",label:"选择加密方案"},null,8,["modelValue"])]),ss.value?(h(),l("div",ie,[t("label",re,[n(i(z),{class:"w-4 h-4"}),s[16]||(s[16]=t("span",null,"WiFi 密码",-1))]),t("div",oe,[c(t("input",{"onUpdate:modelValue":s[3]||(s[3]=e=>Ze.value.key=e),type:De.value?"text":"password",class:"input pr-10",placeholder:"输入 WiFi 密码",autocomplete:"new-password"},null,8,ce),[[d,Ze.value.key]]),t("button",{type:"button",class:"absolute right-3 top-1/2 -translate-y-1/2 text-slate-500 hover:text-primary-400 p-1 transition-colors",onClick:s[4]||(s[4]=e=>De.value=!De.value)},[(h(),p(m(De.value?i(K):i(q)),{class:"w-4 h-4"}))])])])):v("",!0),t("div",ue,[t("label",de,[n(i(E),{class:"w-4 h-4"}),s[17]||(s[17]=t("span",null,"WiFi 频段",-1))]),n(M,{modelValue:Ze.value.band,"onUpdate:modelValue":s[5]||(s[5]=e=>Ze.value.band=e),options:[{value:"2G",label:"2.4G"},{value:"5G",label:"5G"}],placeholder:"选择 WiFi 频段",label:"选择 WiFi 频段"},null,8,["modelValue"])]),t("div",pe,[t("button",{class:"btn btn-secondary flex-1",onClick:fs},[n(i(T),{class:"w-4 h-4"}),s[18]||(s[18]=o(" 仅保存 ",-1))]),t("button",{class:"btn btn-primary flex-1",onClick:ys},[n(i(J),{class:"w-4 h-4"}),s[19]||(s[19]=o(" 保存并连接 ",-1))])])],32)]),n(_,{visible:$e.value,title:"选择已知热点",icon:i(T),onClose:s[8]||(s[8]=e=>$e.value=!1)},{footer:y(()=>[t("button",{class:"btn btn-secondary w-full",onClick:s[7]||(s[7]=e=>$e.value=!1)},"取消")]),default:y(()=>[t("div",me,[0===i(Oe).knownNetworks.length?(h(),l("div",ve,[t("div",ye,[n(i(T),{class:"w-8 h-8 text-slate-500"})]),s[20]||(s[20]=t("p",{class:"text-slate-400 mb-1"},"暂无已知热点",-1)),s[21]||(s[21]=t("p",{class:"text-xs text-slate-500"},"请先手动输入添加",-1))])):v("",!0),(h(!0),l(f,null,w(i(Oe).knownNetworks,e=>(h(),l("div",{key:e.name,class:"flex justify-between items-center p-4 mx-2 mb-2 rounded-xl cursor-pointer transition-all duration-150 bg-dark-300/50 hover:bg-primary-500/10 border border-slate-700/50 hover:border-primary-500/30",onClick:s=>function(e){Ze.value.ssid=e.name,Ze.value.encryption=e.encryption||"psk2",Ze.value.key=e.password||"",Ze.value.band=e.band.toUpperCase(),$e.value=!1}(e)},[t("div",be,[t("div",xe,[n(i(U),{class:"w-5 h-5 text-primary-400"})]),t("span",he,g(e.name),1)]),t("div",we,[t("span",ge,g(e.band),1),(h(),p(m("none"===e.encryption||"owe"===e.encryption?i(B):i(z)),{class:k(["w-4 h-4","none"===e.encryption||"owe"===e.encryption?"text-warning-400":"text-success-400"])},null,8,["class"]))])],8,fe))),128))])]),_:1},8,["visible","icon"]),n(_,{visible:He.value,title:"保存确认",icon:i(J),onClose:s[10]||(s[10]=e=>He.value=!1)},{footer:y(()=>[t("button",{class:"btn btn-secondary flex-1",onClick:s[9]||(s[9]=e=>He.value=!1)},"取消"),t("button",{class:"btn btn-primary flex-1",onClick:hs},[n(i(J),{class:"w-4 h-4"}),s[24]||(s[24]=o(" 确定连接 ",-1))])]),default:y(()=>[t("div",ke,[s[23]||(s[23]=t("p",{class:"text-slate-300"},"确定要保存配置并连接吗？",-1)),t("div",je,[n(i(G),{class:"w-5 h-5 text-warning-400 flex-shrink-0 mt-0.5"}),s[22]||(s[22]=t("div",{class:"text-sm"},[t("p",{class:"text-warning-300 font-medium mb-1"},"WiFi 将会重启"),t("p",{class:"text-slate-400"},"系统重启期间，WiFi连接将会断开。")],-1))])])]),_:1},8,["visible","icon"]),n(_,{visible:Qe.value,title:"附近热点",icon:i(O),onClose:vs},{footer:y(()=>[t("div",Ue,[t("p",ze,[Ye.value&&!i(Oe).isScanning?(h(),l("span",Ke,"扫描时间 "+g(Ye.value),1)):v("",!0)]),t("button",{class:k(["btn w-full gap-2 bg-gradient-to-r from-primary-500 to-primary-600 hover:from-primary-400 hover:to-primary-500 text-white font-medium shadow-lg shadow-primary-500/25 transition-all duration-200",{"opacity-70 cursor-not-allowed":i(Oe).isScanning}]),disabled:i(Oe).isScanning,onClick:ms},[i(Oe).isScanning?(h(),p(i(N),{key:0,class:"w-4 h-4 animate-spin"})):(h(),p(i(O),{key:1,class:"w-4 h-4"})),t("span",null,g(Xe.value?"重新扫描":"开始扫描"),1)],10,qe)])]),default:y(()=>[t("div",Ce,[i(Oe).isScanning?(h(),l("div",We,[t("div",Se,[n(i(N),{class:"w-8 h-8 text-primary-400 animate-spin"})]),s[25]||(s[25]=t("p",{class:"text-slate-300 mb-1"},"正在扫描...",-1)),s[26]||(s[26]=t("p",{class:"text-xs text-slate-500"},"请稍等，大约需要 5 秒",-1))])):Xe.value||0!==i(Oe).scannedNetworks.length?Xe.value&&0===i(Oe).scannedNetworks.length?(h(),l("div",Ne,[t("div",_e,[n(i($),{class:"w-8 h-8 text-slate-500"})]),s[28]||(s[28]=t("p",{class:"text-slate-400 mb-2"},"未找到热点",-1)),s[29]||(s[29]=t("p",{class:"text-xs text-slate-500 leading-relaxed text-center"},[o("建议用电脑网线连接路由器扫描"),t("br"),o("扫描过程中可能会断开 WiFi"),t("br"),o("不能 100% 收到返回结果"),t("br"),o('不过可以"重新扫描"试试')],-1))])):v("",!0):(h(),l("div",Fe,[t("div",Ge,[n(i(O),{class:"w-8 h-8 text-primary-400"})]),s[27]||(s[27]=t("p",{class:"text-slate-300"},"点击下方按钮开始扫描",-1))])),(h(!0),l(f,null,w(ns.value,e=>{return h(),l("div",{key:e.bssid,class:"flex justify-between items-center p-4 mx-2 mb-2 rounded-xl cursor-pointer transition-all duration-150 bg-dark-300/50 hover:bg-primary-500/10 border border-slate-700/50 hover:border-primary-500/30",onClick:s=>function(e){var s,a,l,t,n;e.ssid?(Ze.value.ssid=e.ssid,Ze.value.encryption=(s=e.encryption).enabled?(null==(a=s.wpa)?void 0:a.includes(2))&&(null==(l=s.authentication)?void 0:l.includes("sae"))?"sae":(null==(t=s.wpa)?void 0:t.includes(2))?"psk2":(null==(n=s.wpa)?void 0:n.includes(1))?"psk":"psk2":"none",Ze.value.key="",Ze.value.band="2.4G"===e.band?"2G":"5G",Qe.value=!1):Re.error("隐藏网络无法选择")}(e)},[t("div",Pe,[t("div",Ae,[(h(),l("svg",Ve,[t("circle",{cx:"12",cy:"19",r:"2",style:C({fill:ts(e.signal).hex})},null,4),t("path",{d:"M8.5 15.5C9.5 14.5 10.7 14 12 14s2.5.5 3.5 1.5",style:C({stroke:ts(e.signal).level>=1?ts(e.signal).hex:"#475569"}),"stroke-width":"2","stroke-linecap":"round"},null,4),t("path",{d:"M5.5 12.5C7.3 10.7 9.5 10 12 10s4.7.7 6.5 2.5",style:C({stroke:ts(e.signal).level>=2?ts(e.signal).hex:"#475569"}),"stroke-width":"2","stroke-linecap":"round"},null,4),t("path",{d:"M2.5 9.5C5.2 6.8 8.4 6 12 6s6.8.8 9.5 3.5",style:C({stroke:ts(e.signal).level>=3?ts(e.signal).hex:"#475569"}),"stroke-width":"2","stroke-linecap":"round"},null,4)]))]),t("div",Te,[t("p",Le,g(e.ssid),1),t("p",Ie,g(e.band)+" · "+g(as(e.encryption)),1)])]),t("span",{class:k(["text-xs flex-shrink-0",(s=e.signal,s>=-65?"text-success-400":s>=-75?"text-warning-400":"text-danger-400")])},g(ls(e.signal)),3)],8,Me);var s}),128))])]),_:1},8,["visible","icon"])],64))}});
/**
 * @license lucide-vue-next v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */export{Ee as default};
