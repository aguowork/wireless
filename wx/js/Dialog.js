import{e as t,N as e,f as o,i as s,T as a,w as l,p as r,o as i,j as n,g as c,u as d,m as u,l as m,t as y,Q as w}from"./vue-vendor.js";import{c as h,_ as b}from"./index.js";
/**
 * @license lucide-vue-next v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const g=h("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);const f=new class{constructor(){}async callViaCgi(t,e={}){const o=Object.keys(e).length>0,s=`/cgi-bin/wx-auth.sh?action=ubus&method=${t}`,a="auto_switch"===t?12e4:3e4,l=new AbortController,r=setTimeout(()=>l.abort(),a);try{const a=localStorage.getItem("wx_auth_token"),n=await fetch(s,{method:o?"POST":"GET",headers:{...o?{"Content-Type":"application/json"}:{},...a?{Authorization:a}:{}},body:o?JSON.stringify(e):void 0,signal:l.signal});if(clearTimeout(r),!n.ok)throw new Error(`HTTP错误: ${n.status}`);const c=await n.text();if(!c.trim())throw new Error("服务器返回空响应");let d;try{d=JSON.parse(c)}catch(i){throw new Error("服务器返回无效的JSON格式")}if("error"===d.status){if(401===d.code||"未授权的操作"===d.message)return localStorage.removeItem("wx_auth_token"),localStorage.removeItem("ubus_session"),localStorage.removeItem("wx_authenticated"),localStorage.removeItem("wx_auth_time"),localStorage.setItem("wx_logout_reason","conflict"),window.location.reload(),new Promise(()=>{});if("auto_switch"===t)return d;throw new Error(d.message||"请求失败")}return d}catch(n){if(clearTimeout(r),n instanceof Error&&"AbortError"===n.name)throw new Error("请求超时");throw n}}async call(t,e,o={}){if("wx-wireless"===t)return this.callViaCgi(e,o);throw new Error(`Does not support generic ubus calls: ${t}.${e}`)}async batch(t){return Promise.all(t.map(({object:t,method:e,params:o})=>this.call(t,e,o)))}},p={class:"dialog-content"},v={key:1,class:"dialog-title"},x={class:"relative z-10"},_={class:"mt-6 flex gap-3 relative z-10"},k=b(t({__name:"Dialog",props:{visible:{type:Boolean},title:{},icon:{},closable:{type:Boolean,default:!0}},emits:["close"],setup(t,{emit:h}){const b=t,f=h;function k(t){b.closable&&t.target===t.currentTarget&&f("close")}let T=0;return e(()=>b.visible,t=>{t?(T=window.scrollY,document.body.style.position="fixed",document.body.style.top=`-${T}px`,document.body.style.left="0",document.body.style.right="0",document.body.style.width="100%",document.body.style.overflow="hidden"):(document.body.style.position="",document.body.style.top="",document.body.style.left="",document.body.style.right="",document.body.style.width="",document.body.style.overflow="",window.scrollTo({top:T,behavior:"instant"}))},{immediate:!0}),(e,h)=>(i(),o(r,{to:"body"},[s(a,{name:"dialog"},{default:l(()=>[t.visible?(i(),n("div",{key:0,class:"dialog-overlay",onClick:k},[c("div",p,[t.closable?(i(),n("button",{key:0,class:"absolute top-4 right-4 w-8 h-8 rounded-lg bg-slate-700/50 hover:bg-slate-700 flex items-center justify-center text-slate-400 hover:text-white transition-colors",onClick:h[0]||(h[0]=t=>f("close"))},[s(d(g),{class:"w-4 h-4"})])):u("",!0),t.title?(i(),n("div",v,[t.icon?(i(),o(m(t.icon),{key:0,class:"w-5 h-5 text-primary-400"})):u("",!0),c("span",null,y(t.title),1)])):u("",!0),c("div",x,[w(e.$slots,"default",{},void 0,!0)]),c("div",_,[w(e.$slots,"footer",{},()=>[c("button",{class:"btn btn-primary flex-1",onClick:h[1]||(h[1]=t=>f("close"))},"确定")],!0)])])])):u("",!0)]),_:3})]))}}),[["__scopeId","data-v-a6fefa30"]]);export{k as D,g as X,f as u};
