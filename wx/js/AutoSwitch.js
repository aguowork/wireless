import{e,I as t,j as a,g as l,i as s,u as i,B as r,k as n,F as u,G as c,J as o,t as v,x as d,f as x,l as f,m as h,w as b,r as m,c as p,C as w,o as y,z as g,A as k}from"./vue-vendor.js";import{c as C,a as j,I as _,T as I,_ as M}from"./index.js";import{l as N,g as A,b as B,t as S,m as $}from"./wireless3.js";import{D as z}from"./Dialog.js";import{Z as F}from"./zap.js";import{W as O}from"./wifi.js";
/**
 * @license lucide-vue-next v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const T=C("clock",[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),W=C("play",[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]]),D=C("timer",[["line",{x1:"10",x2:"14",y1:"2",y2:"2",key:"14vaq8"}],["line",{x1:"12",x2:"15",y1:"14",y2:"11",key:"17fdiu"}],["circle",{cx:"12",cy:"14",r:"8",key:"1e1u0o"}]]),P={class:"flex flex-col space-y-4",style:{height:"calc(100vh - 180px)","min-height":"300px"}},q={class:"flex items-center gap-3 px-1"},G={class:"w-9 h-9 rounded-xl bg-gradient-to-br from-warning-500/20 to-warning-600/10 flex items-center justify-center"},J={class:"flex gap-3 flex-shrink-0"},U=["disabled"],V={class:"flex items-center gap-2 mb-4"},Z={class:"w-7 h-7 rounded-lg bg-primary-500/20 flex items-center justify-center"},E={class:"space-y-2.5 flex-1"},H={class:"w-5 h-5 rounded bg-slate-800/80 flex items-center justify-center text-xs text-primary-400 font-medium flex-shrink-0"},K={class:"leading-relaxed"},L={key:1,class:"flex-1 flex flex-col items-center justify-center"},Q=["cx","cy"],R=["cx","cy","stroke-dashoffset"],X={class:"absolute inset-0 flex items-center justify-center"},Y={class:"text-3xl font-bold text-white tabular-nums"},ee={key:1,class:"wifi-icon w-20 h-20 rounded-2xl bg-primary-500/20 flex items-center justify-center mb-4"},te={key:0,class:"w-12 h-12",viewBox:"0 0 24 24",fill:"none"},ae={class:"text-lg font-semibold text-white mb-1 transition-all duration-300 text-center max-w-[280px] leading-relaxed whitespace-pre-line"},le={class:"h-6 flex items-center justify-center"},se={key:0,class:"flex items-center gap-1.5 px-3 py-1 rounded-full bg-slate-800/60 animate-fade-in"},ie={class:"text-xs text-slate-500"},re={class:"space-y-4"},ne={class:"form-group"},ue={class:"form-label"},ce=120,oe=M(e({__name:"AutoSwitch",setup(e){const C=j(),M=w(),oe=m(!1),ve=m(0);async function de(){oe.value=!0;try{const e=await N();ve.value=e.interval||0}catch{ve.value=0}}const xe=m("idle"),fe=m(""),he=m(""),be=m(0),me=m(""),pe=m(null),we=m("");function ye(e){return null===e?{text:"未知",color:"text-slate-500",level:0,hex:"#64748b"}:e>=-50?{text:"极强",color:"text-success-400",level:3,hex:"#4ade80"}:e>=-65?{text:"强",color:"text-success-400",level:2,hex:"#4ade80"}:e>=-75?{text:"中",color:"text-warning-400",level:1,hex:"#fbbf24"}:{text:"弱",color:"text-danger-400",level:0,hex:"#f87171"}}function ge(e){const t=parseInt(e);return isNaN(t)?null:t}function ke(e){var t;return{wifiConnected:(null==(t=e.bridge_status)?void 0:t.includes("连接成功"))??!1,networkOk:"连接成功"===e.network_status}}let Ce=null,je=null;function _e(e){return e>65?"正在尝试连接新热点":e>50?"正在重启无线驱动":e>35?"等待设备连接信号":e>15?"检测连接状态":"即将跳转到状态页"}async function Ie(){if("switching"===xe.value)return;fe.value="",he.value="",be.value=0,me.value="",pe.value=null,we.value="",Ne=0,xe.value="switching",fe.value="正在检查系统配置",await Me(400);let e=null;try{if(e=await A(),!e.relay_enabled)return xe.value="error",void(he.value="中继模式未开启\n请先前往「连接状态」页面开启中继");if(e.sta_count&&e.sta_count>1)return xe.value="error",void(he.value=`检测到${e.sta_count}个STA接口\n请删除多余接口`)}catch{}fe.value="正在检查热点配置",await Me(400);try{if((await B()).length<2)return xe.value="error",void(he.value="需要配置 2 个以上热点才能切换")}catch{return xe.value="error",void(he.value="无法读取热点配置")}if(fe.value="正在检查网络状态",await Me(400),e){const{wifiConnected:t,networkOk:a}=ke(e);if(t&&a)return await Me(400),xe.value="success",me.value=e.ssid,he.value=`${e.ssid} 网络正常`,pe.value=ge(e.signal),void(we.value=e.band||"")}fe.value="正在触发热点切换",S().catch(()=>{}),Ae(),xe.value="switching",be.value=80,fe.value=_e(80),Ce=setInterval(()=>{be.value--,fe.value=_e(be.value),50!==be.value||je||(Ne=0,je=setInterval(async()=>{try{const e=await A(),{wifiConnected:t,networkOk:a}=ke(e);if(t&&a)return Ae(),me.value=e.ssid,pe.value=ge(e.signal),we.value=e.band||"",xe.value="success",void(he.value="");if(t&&!a)return Ne++,fe.value=`已连接 ${e.ssid}，等待网络`,void(Ne>=3&&(Ae(),me.value=e.ssid,pe.value=ge(e.signal),we.value=e.band||"",xe.value="success",he.value="WiFi已连接，但网络不可用"));Ne=0}catch{Ne=0}},5e3)),be.value<=0&&(Ae(),M.push("/status"))},1e3)}function Me(e){return new Promise(t=>setTimeout(t,e))}let Ne=0;function Ae(){Ce&&(clearInterval(Ce),Ce=null),je&&(clearInterval(je),je=null)}async function Be(){oe.value=!1;const e=ve.value,t=!e||Number.isNaN(e)||0===e?0:Number(e);if(t<0||t>59)C.error("请输入0-59之间的整数");else try{await $(t),ve.value=t,0===t?C.success("定时任务已关闭"):C.success(`定时任务已设置为每${t}分钟执行`)}catch(a){C.error("设置失败")}}t(()=>{Ae()});const Se=p(()=>{switch(xe.value){case"switching":return{icon:F,iconClass:"text-primary-400",bgClass:"bg-primary-500/20",title:fe.value,subtitle:"",subtitleClass:"text-slate-500"};case"success":{const e=he.value.includes("不可用"),t=he.value.includes("正常");return{icon:e?I:O,iconClass:e?"text-warning-400":"text-success-400",bgClass:e?"bg-warning-500/20":"bg-success-500/20",title:me.value||"已连接",subtitle:t?"网络正常，无需切换":e?he.value:"切换成功",subtitleClass:e?"text-warning-400":"text-success-400"}}case"error":return{icon:I,iconClass:"text-warning-400",bgClass:"bg-warning-500/20",title:he.value||"操作失败",subtitle:"",subtitleClass:"text-slate-400"};default:return{icon:_,iconClass:"text-primary-400",bgClass:"bg-primary-500/20",title:"",subtitle:"",subtitleClass:""}}}),$e=2*Math.PI*57,ze=p(()=>{const e=be.value>0?be.value/80*100:0;return $e*(1-e/100)}),Fe=[{text:"需要配置 2 个热点才能切换"},{text:"切换过程中 WiFi 会断开连接"},{text:"倒计时结束后自动跳转到状态页"},{text:"定时检测可在热点无网就自动切换"}];return(e,t)=>(y(),a(u,null,[l("div",P,[l("div",q,[l("div",G,[s(i(F),{class:"w-4 h-4 text-warning-400"})]),t[2]||(t[2]=l("div",null,[l("h2",{class:"text-lg font-bold text-white"},"智能切换"),l("p",{class:"text-[10px] text-slate-500"},"Smart Switch")],-1))]),l("div",J,[l("button",{class:"btn btn-primary flex-1 h-11",disabled:"switching"===xe.value,onClick:Ie},[s(i(W),{class:"w-4 h-4"}),t[3]||(t[3]=r(" 开始切换 ",-1))],8,U),l("button",{class:"btn btn-secondary flex-1 h-11",onClick:de},[s(i(T),{class:"w-4 h-4"}),t[4]||(t[4]=r(" 定时检测 ",-1))])]),l("div",{class:n(["flex-1 rounded-2xl border backdrop-blur-sm p-6 flex flex-col transition-all duration-500 ease-out",["idle"===xe.value?"bg-slate-900/60 border-slate-700/50":"switching"===xe.value?"bg-gradient-to-br from-primary-900/40 to-slate-900/60 border-primary-500/30":"success"===xe.value?"bg-gradient-to-br from-emerald-900/40 to-slate-900/60 border-emerald-500/30":"bg-gradient-to-br from-amber-900/40 to-slate-900/60 border-amber-500/30"]])},["idle"===xe.value?(y(),a(u,{key:0},[l("div",V,[l("div",Z,[s(i(_),{class:"w-4 h-4 text-primary-400"})]),t[5]||(t[5]=l("span",{class:"text-sm font-medium text-slate-300"},"使用须知",-1))]),l("ul",E,[(y(),a(u,null,c(Fe,(e,t)=>l("li",{key:t,class:"flex items-start gap-2.5 text-sm text-slate-400"},[l("span",H,v(t+1),1),l("span",K,v(e.text),1)])),64))])],64)):(y(),a("div",L,["switching"===xe.value&&be.value>0?(y(),a("div",{key:0,class:"relative mb-4",style:o({width:ce+"px",height:ce+"px"})},[(y(),a("svg",{class:"absolute inset-0 -rotate-90",width:ce,height:ce},[l("circle",{cx:60,cy:60,r:57,fill:"none","stroke-width":6,class:"stroke-slate-700/50"},null,8,Q),l("circle",{cx:60,cy:60,r:57,fill:"none","stroke-width":6,"stroke-linecap":"round",class:"stroke-primary-400 transition-all duration-1000 ease-linear","stroke-dasharray":$e,"stroke-dashoffset":ze.value},null,8,R)])),l("div",X,[l("span",Y,v(be.value),1)])],4)):"switching"===xe.value?(y(),a("div",ee,[...t[6]||(t[6]=[d('<svg class="w-12 h-12" viewBox="0 0 24 24" fill="none" data-v-b79d4067><circle cx="12" cy="19" r="2" fill="white" data-v-b79d4067></circle><path class="wifi-arc wifi-arc-1" d="M8.5 15.5C9.5 14.5 10.7 14 12 14s2.5.5 3.5 1.5" stroke="white" stroke-width="2" stroke-linecap="round" data-v-b79d4067></path><path class="wifi-arc wifi-arc-2" d="M5.5 12.5C7.3 10.7 9.5 10 12 10s4.7.7 6.5 2.5" stroke="white" stroke-width="2" stroke-linecap="round" data-v-b79d4067></path><path class="wifi-arc wifi-arc-3" d="M2.5 9.5C5.2 6.8 8.4 6 12 6s6.8.8 9.5 3.5" stroke="white" stroke-width="2" stroke-linecap="round" data-v-b79d4067></path></svg>',1)])])):(y(),a("div",{key:2,class:n(["w-20 h-20 rounded-2xl flex items-center justify-center mb-4 transition-all duration-500",Se.value.bgClass])},["success"!==xe.value||he.value.includes("不可用")||null===pe.value?(y(),x(f(Se.value.icon),{key:1,class:n(["w-10 h-10 transition-all duration-300",Se.value.iconClass])},null,8,["class"])):(y(),a("svg",te,[l("circle",{cx:"12",cy:"19",r:"2",style:o({fill:ye(pe.value).hex})},null,4),l("path",{d:"M8.5 15.5C9.5 14.5 10.7 14 12 14s2.5.5 3.5 1.5",style:o({stroke:ye(pe.value).level>=1?ye(pe.value).hex:"#475569"}),"stroke-width":"2","stroke-linecap":"round"},null,4),l("path",{d:"M5.5 12.5C7.3 10.7 9.5 10 12 10s4.7.7 6.5 2.5",style:o({stroke:ye(pe.value).level>=2?ye(pe.value).hex:"#475569"}),"stroke-width":"2","stroke-linecap":"round"},null,4),l("path",{d:"M2.5 9.5C5.2 6.8 8.4 6 12 6s6.8.8 9.5 3.5",style:o({stroke:ye(pe.value).level>=3?ye(pe.value).hex:"#475569"}),"stroke-width":"2","stroke-linecap":"round"},null,4)]))],2)),l("p",ae,v(Se.value.title),1),l("p",{class:n(["text-sm mb-4 transition-all duration-300 h-5",Se.value.subtitleClass])},v(Se.value.subtitle||""),3),l("div",le,["success"===xe.value&&null!==pe.value?(y(),a("div",se,[l("span",{class:n(["text-xs font-medium",ye(pe.value).color])},v(we.value?we.value+" ":"")+"信号 "+v(ye(pe.value).text),3),l("span",ie,v(pe.value)+" dBm",1)])):h("",!0)])]))],2)]),s(z,{visible:oe.value,title:"定时检测",icon:i(D),onClose:t[1]||(t[1]=e=>oe.value=!1)},{footer:b(()=>[l("button",{class:"btn btn-primary w-full",onClick:Be},"确定")]),default:b(()=>[l("div",re,[l("div",ne,[l("label",ue,[s(i(T),{class:"w-4 h-4"}),t[7]||(t[7]=l("span",null,"检测间隔（分钟）",-1))]),g(l("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>ve.value=e),type:"number",class:"input",min:"0",max:"59",placeholder:"建议 15-30，输入 0 关闭"},null,512),[[k,ve.value,void 0,{number:!0}]])]),t[8]||(t[8]=l("p",{class:"text-xs text-slate-500"},"断网后自动连接已知热点",-1))])]),_:1},8,["visible","icon"])],64))}}),[["__scopeId","data-v-b79d4067"]]);
/**
 * @license lucide-vue-next v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */export{oe as default};
