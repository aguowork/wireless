import{e as t,v as s,I as e,j as a,g as n,i as l,u as i,y as o,k as c,t as r,w as d,T as u,B as f,m as p,F as v,r as m,o as h,C as g,f as y,l as x,J as b}from"./vue-vendor.js";import{u as w}from"./wireless2.js";import{c as k,a as S,T as _,_ as C}from"./index.js";import{D as j}from"./Dialog.js";import{C as M,r as L}from"./system.js";import{d as q,g as I}from"./wireless3.js";import{W as R}from"./wifi.js";import{P as T}from"./power.js";import{L as N}from"./lock.js";import{R as W}from"./radio.js";import{A}from"./activity.js";import{E as B,a as P}from"./eye.js";
/**
 * @license lucide-vue-next v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const D=k("globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]),F=k("link-2",[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]]),H=k("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),O=k("rotate-ccw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]),z={class:"space-y-4"},E={class:"card"},J={class:"flex items-center justify-between mb-5"},G={class:"flex items-center gap-3"},K={class:"w-10 h-10 rounded-xl bg-gradient-to-br from-primary-500/20 to-primary-600/10 flex items-center justify-center"},Q={class:"py-6 text-center text-slate-500"},U={class:"space-y-3 pt-1"},V={class:"info-row"},X={class:"info-label"},Y={class:"info-value"},Z={key:0,class:"font-medium"},$={class:"info-label"},tt={class:"info-value"},st={key:0,class:"flex items-center gap-2"},et={class:"font-mono"},at={class:"info-row"},nt={class:"info-label"},lt={class:"info-value"},it={key:0,class:"badge uppercase"},ot={class:"info-row"},ct={class:"info-label"},rt={class:"info-value"},dt={class:"info-row"},ut={class:"info-label"},ft={class:"info-value"},pt={key:0,class:"flex items-center gap-2"},vt={class:"w-5 h-5",viewBox:"0 0 24 24",fill:"none"},mt={class:"info-row"},ht={class:"info-label"},gt={class:"info-value"},yt={class:"card"},xt={class:"flex items-center justify-between mb-4 h-9"},bt={class:"flex items-center gap-3"},wt={class:"w-9 h-9 rounded-xl bg-gradient-to-br from-warning-500/20 to-warning-600/10 flex items-center justify-center"},kt=["disabled"],St={class:"space-y-3"},_t={class:"info-row"},Ct={class:"info-label"},jt={class:"info-value"},Mt={class:"info-row"},Lt={class:"info-label"},qt={class:"info-value font-medium"},It={key:0},Rt={class:"info-row"},Tt={class:"info-label"},Nt={class:"info-value font-medium"},Wt={key:0},At={key:0,class:"p-3 rounded-xl bg-warning-500/10 border border-warning-500/20"},Bt={class:"flex items-start gap-3"},Pt={class:"card"},Dt={class:"grid grid-cols-2 gap-3"},Ft={class:"flex items-start gap-4 p-4 rounded-xl bg-danger-500/10 border border-danger-500/20"},Ht={class:"flex gap-3 w-full"},Ot={class:"space-y-4"},zt={class:"p-4 rounded-xl bg-warning-500/10 border border-warning-500/20"},Et={class:"flex items-start gap-3"},Jt={class:"text-sm"},Gt={class:"text-warning-300 font-medium mb-2"},Kt=C(t({__name:"Status",setup(t){const k=g(),C=w(),Kt=S(),Qt=m(!1),Ut=m(!1),Vt=m(!1),Xt=m(!1);async function Yt(t=!0){t&&Kt.showLoading();try{await Promise.all([C.fetchConnectionStatus(),C.fetchRetryStatus()])}finally{Kt.hideLoading()}C.error&&Kt.error(C.error)}function Zt(){Qt.value=!Qt.value}async function $t(){Ut.value=!1,Kt.showLoading();try{const t=await L();"success"===t.status?Kt.startCountdown(60,()=>{Kt.hideLoading(),k.push("/login")}):(Kt.hideLoading(),Kt.error(t.message||"重启失败"))}catch(t){Kt.hideLoading(),Kt.error("重启请求失败")}}async function ts(){await C.resetRetryCount()?(Kt.success("重试计数已重置"),await C.fetchRetryStatus()):Kt.error(C.error||"重置失败")}function ss(t){if(!t)return"status-disconnected";const s=parseInt(t);return isNaN(s)?"status-disconnected":s>=-65?"status-connected":s>=-75?"status-warning":"status-disconnected"}function es(t){if(!t)return{level:0,hex:"#64748b"};const s=parseInt(t);return isNaN(s)?{level:0,hex:"#64748b"}:s>=-50?{level:3,hex:"#4ade80"}:s>=-65?{level:2,hex:"#4ade80"}:s>=-75?{level:1,hex:"#fbbf24"}:{level:0,hex:"#f87171"}}function as(){window.open("http://"+window.location.hostname+"/cgi-bin/luci/admin/network/wireless","_blank")}s(async()=>{var t;Kt.loadingText="正在同步设备状态",await Yt(!1),(null==(t=C.connectionStatus)?void 0:t.sta_count)&&C.connectionStatus.sta_count>1&&(Vt.value=!0)});let ns=null,ls=null;function is(){ls&&(clearTimeout(ls),ls=null),ns&&(clearInterval(ns),ns=null)}async function os(){Xt.value=!1,q().catch(()=>{}),Kt.startCountdown(60,()=>{is(),Kt.hideLoading(),Yt(!1)}),ls=setTimeout(()=>{ns||(ns=setInterval(async()=>{try{(await I()).relay_enabled||(is(),Kt.hideLoading(),Kt.success("中继模式已关闭"),Yt(!1))}catch{}},3e3))},3e4)}function cs(){var t;(null==(t=C.connectionStatus)?void 0:t.relay_enabled)?Xt.value=!0:k.push("/connect")}return e(()=>{is()}),(t,s)=>{var e,m,g,w;return h(),a(v,null,[n("div",z,[n("div",E,[n("div",J,[n("div",G,[n("div",K,[l(i(R),{class:"w-5 h-5 text-primary-400"})]),s[5]||(s[5]=n("div",null,[n("h2",{class:"text-lg font-bold text-white"},"中继模式"),n("p",{class:"text-xs text-slate-500"},"Relay Mode")],-1))]),n("div",{class:c(["flex items-center gap-2 px-3 py-1.5 rounded-full text-sm font-medium transition-colors cursor-pointer select-none touch-manipulation",(null==(e=i(C).connectionStatus)?void 0:e.relay_enabled)?"bg-success-500/20 text-success-400":"bg-slate-700/50 text-slate-500"]),onClick:o(cs,["stop","prevent"]),style:{"-webkit-tap-highlight-color":"transparent"}},[l(i(T),{class:"w-4 h-4"}),n("span",null,r((null==(m=i(C).connectionStatus)?void 0:m.relay_enabled)?"已开启":"已关闭"),1)],2)]),n("div",{class:c(["grid-wrapper",{open:!1===(null==(g=i(C).connectionStatus)?void 0:g.relay_enabled),"transition-enabled":!0}])},[n("div",null,[n("div",Q,[l(i(R),{class:"w-8 h-8 mx-auto mb-2 opacity-50"}),s[6]||(s[6]=n("p",null,"无线中继已关闭",-1))])])],2),n("div",{class:c(["grid-wrapper",{open:!1!==(null==(w=i(C).connectionStatus)?void 0:w.relay_enabled),"transition-enabled":!0}])},[n("div",null,[n("div",U,[n("div",V,[n("div",X,[l(i(R),{class:"w-4 h-4 text-primary-400"}),s[7]||(s[7]=n("span",null,"名称",-1))]),n("div",Y,[l(u,{name:"fade",mode:"out-in"},{default:d(()=>[i(C).connectionStatus?(h(),a("span",Z,r(i(C).connectionStatus.ssid),1)):p("",!0)]),_:1})])]),n("div",{class:"info-row cursor-pointer group",onClick:Zt},[n("div",$,[l(i(N),{class:"w-4 h-4 text-primary-400"}),s[8]||(s[8]=n("span",null,"密码",-1))]),n("div",tt,[l(u,{name:"fade",mode:"out-in"},{default:d(()=>[i(C).connectionStatus?(h(),a("div",st,[n("span",et,r(Qt.value?i(C).connectionStatus.key:"••••••••"),1),(h(),y(x(Qt.value?i(B):i(P)),{class:"w-4 h-4 text-slate-500 group-hover:text-primary-400 transition-colors"}))])):p("",!0)]),_:1})])]),n("div",at,[n("div",nt,[l(i(W),{class:"w-4 h-4 text-primary-400"}),s[9]||(s[9]=n("span",null,"频段",-1))]),n("div",lt,[l(u,{name:"fade",mode:"out-in"},{default:d(()=>[i(C).connectionStatus?(h(),a("span",it,r(i(C).connectionStatus.band),1)):p("",!0)]),_:1})])]),n("div",ot,[n("div",ct,[l(i(F),{class:"w-4 h-4 text-primary-400"}),s[10]||(s[10]=n("span",null,"接口",-1))]),n("div",rt,[l(u,{name:"fade",mode:"out-in"},{default:d(()=>[i(C).connectionStatus?(h(),a("span",{key:0,class:c(["status-tag",i(C).connectionStatus.interface.includes("不存在")?"status-disconnected":"status-connected"])},r(i(C).connectionStatus.interface),3)):p("",!0)]),_:1})])]),n("div",dt,[n("div",ut,[l(i(M),{class:"w-4 h-4 text-primary-400"}),s[11]||(s[11]=n("span",null,"状态",-1))]),n("div",ft,[l(u,{name:"fade",mode:"out-in"},{default:d(()=>[i(C).connectionStatus?(h(),a("div",pt,[n("span",{class:c(["status-tag",i(C).connectionStatus.bridge_status.includes("成功")?"status-connected":"status-disconnected"])},r(i(C).connectionStatus.bridge_status.includes("成功")?"连接成功":"连接失败"),3),i(C).connectionStatus.bridge_status.includes("成功")&&i(C).connectionStatus.signal?(h(),a("span",{key:0,class:c(["status-tag flex items-center gap-1.5",ss(i(C).connectionStatus.signal)])},[(h(),a("svg",vt,[n("circle",{cx:"12",cy:"19",r:"2",style:b({fill:es(i(C).connectionStatus.signal).hex})},null,4),n("path",{d:"M8.5 15.5C9.5 14.5 10.7 14 12 14s2.5.5 3.5 1.5",style:b({stroke:es(i(C).connectionStatus.signal).level>=1?es(i(C).connectionStatus.signal).hex:"#475569"}),"stroke-width":"2","stroke-linecap":"round"},null,4),n("path",{d:"M5.5 12.5C7.3 10.7 9.5 10 12 10s4.7.7 6.5 2.5",style:b({stroke:es(i(C).connectionStatus.signal).level>=2?es(i(C).connectionStatus.signal).hex:"#475569"}),"stroke-width":"2","stroke-linecap":"round"},null,4),n("path",{d:"M2.5 9.5C5.2 6.8 8.4 6 12 6s6.8.8 9.5 3.5",style:b({stroke:es(i(C).connectionStatus.signal).level>=3?es(i(C).connectionStatus.signal).hex:"#475569"}),"stroke-width":"2","stroke-linecap":"round"},null,4)])),f(" "+r(i(C).connectionStatus.signal)+" dBm ",1)],2)):p("",!0)])):p("",!0)]),_:1})])]),n("div",mt,[n("div",ht,[l(i(D),{class:"w-4 h-4 text-primary-400"}),s[12]||(s[12]=n("span",null,"网络",-1))]),n("div",gt,[l(u,{name:"fade",mode:"out-in"},{default:d(()=>[i(C).connectionStatus?(h(),a("span",{key:0,class:c(["status-tag","连接成功"===i(C).connectionStatus.network_status?"status-connected":"status-disconnected"])},r(i(C).connectionStatus.network_status),3)):p("",!0)]),_:1})])])])])],2)]),n("div",yt,[n("div",xt,[n("div",bt,[n("div",wt,[l(i(A),{class:"w-4 h-4 text-warning-400"})]),s[13]||(s[13]=n("div",null,[n("h3",{class:"text-lg font-bold text-white"},"重试保护"),n("p",{class:"text-[10px] text-slate-500 font-normal"},"Retry Protection")],-1))]),i(C).retryStatus&&i(C).retryStatus.cq_times>0?(h(),a("button",{key:0,class:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg bg-warning-500/10 text-warning-400 text-xs font-medium hover:bg-warning-500/20 transition-colors",onClick:ts,disabled:i(C).isLoading},[l(i(O),{class:"w-3.5 h-3.5"}),s[14]||(s[14]=f(" 重置 ",-1))],8,kt)):p("",!0)]),n("div",St,[n("div",_t,[n("div",Ct,[l(i(O),{class:"w-4 h-4 text-warning-400"}),s[15]||(s[15]=n("span",null,"失败次数",-1))]),n("div",jt,[l(u,{name:"fade",mode:"out-in"},{default:d(()=>[i(C).retryStatus?(h(),a("span",{key:0,class:c(["status-tag",i(C).retryStatus.cq_times>=i(C).retryStatus.restart_threshold?"status-warning":"status-connected"])},[i(C).retryStatus.cq_times>=i(C).retryStatus.restart_threshold?(h(),y(i(_),{key:0,class:"w-3.5 h-3.5"})):p("",!0),f(" "+r(i(C).retryStatus.cq_times)+" / "+r(i(C).retryStatus.restart_threshold),1)],2)):p("",!0)]),_:1})])]),n("div",Mt,[n("div",Lt,[l(i(A),{class:"w-4 h-4 text-primary-400"}),s[16]||(s[16]=n("span",null,"最大重试",-1))]),n("div",qt,[l(u,{name:"fade",mode:"out-in"},{default:d(()=>[i(C).retryStatus?(h(),a("span",It,r(i(C).retryStatus.max_retries)+" 次",1)):p("",!0)]),_:1})])]),n("div",Rt,[n("div",Tt,[l(i(_),{class:"w-4 h-4 text-primary-400"}),s[17]||(s[17]=n("span",null,"重启阈值",-1))]),n("div",Nt,[l(u,{name:"fade",mode:"out-in"},{default:d(()=>[i(C).retryStatus?(h(),a("span",Wt,r(i(C).retryStatus.restart_threshold)+" 次",1)):p("",!0)]),_:1})])]),i(C).retryStatus&&i(C).retryStatus.cq_times>=i(C).retryStatus.restart_threshold?(h(),a("div",At,[n("div",Bt,[l(i(_),{class:"w-4 h-4 text-warning-400 flex-shrink-0 mt-0.5"}),s[18]||(s[18]=n("div",{class:"text-sm"},[n("p",{class:"text-warning-300 font-medium mb-1"},"即将自动重启"),n("p",{class:"text-slate-400 text-xs"},"重试失败次数过多，为防止无线网卡卡死，系统将自动重启设备。")],-1))])])):p("",!0)])]),n("div",Pt,[n("div",Dt,[n("button",{class:"btn btn-ghost text-danger-400 hover:bg-danger-500/10",onClick:s[0]||(s[0]=t=>Ut.value=!0)},[l(i(T),{class:"w-4 h-4"}),s[19]||(s[19]=n("span",null,"重启系统",-1))]),n("button",{class:"btn btn-ghost",onClick:s[1]||(s[1]=t=>Yt(!0))},[l(i(H),{class:"w-4 h-4"}),s[20]||(s[20]=n("span",null,"刷新状态",-1))])])])]),l(j,{visible:Ut.value,title:"重启确认",icon:i(T),onClose:s[2]||(s[2]=t=>Ut.value=!1)},{footer:d(()=>[n("button",{class:"btn btn-danger flex-1",onClick:$t},[l(i(T),{class:"w-4 h-4"}),s[22]||(s[22]=f(" 确定重启 ",-1))])]),default:d(()=>[n("div",Ft,[l(i(_),{class:"w-5 h-5 text-danger-400 flex-shrink-0 mt-0.5"}),s[21]||(s[21]=n("div",{class:"text-sm text-slate-300"},[n("p",{class:"font-medium text-danger-400 mb-1"},"确定要重启系统吗？"),n("p",{class:"text-slate-400"},"系统重启期间，WiFi连接将会断开。")],-1))])]),_:1},8,["visible","icon"]),l(j,{visible:Xt.value,title:"关闭中继模式",icon:i(T),onClose:s[4]||(s[4]=t=>Xt.value=!1)},{footer:d(()=>[n("div",Ht,[n("button",{class:"btn btn-secondary flex-1",onClick:s[3]||(s[3]=t=>Xt.value=!1)}," 取消 "),n("button",{class:"btn btn-danger flex-1",onClick:os}," 确定 ")])]),_:1},8,["visible","icon"]),l(j,{visible:Vt.value,title:"异常提示",icon:i(_),closable:!1},{footer:d(()=>[n("button",{class:"btn btn-warning w-full",onClick:as},[l(i(D),{class:"w-4 h-4"}),s[25]||(s[25]=f(" 前往 OpenWrt 无线设置 ",-1))])]),default:d(()=>{var t;return[n("div",Ot,[n("div",zt,[n("div",Et,[l(i(_),{class:"w-5 h-5 text-warning-400 flex-shrink-0 mt-0.5"}),n("div",Jt,[n("p",Gt,"检测到 "+r(null==(t=i(C).connectionStatus)?void 0:t.sta_count)+" 个中继接口",1),s[23]||(s[23]=n("p",{class:"text-slate-400 leading-relaxed"},"本项目仅支持单个 STA 中继接口模式，多个接口导致切换异常。",-1))])])]),s[24]||(s[24]=n("div",{class:"p-4 rounded-xl bg-slate-800/50 border border-slate-700/50"},[n("ol",{class:"text-sm text-slate-300 space-y-1.5 list-decimal list-inside"},[n("li",null,"前往 OpenWrt 后台的「网络 - 无线」页面"),n("li",null,"删除多余的中继接口，只保留一个"),n("li",null,"返回本页面刷新")])],-1))])]}),_:1},8,["visible","icon"])],64)}}}),[["__scopeId","data-v-0bdc1ee0"]]);
/**
 * @license lucide-vue-next v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */export{Kt as default};
